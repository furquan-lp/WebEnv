{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}var __extends=this&&this.__extends||function(){var _extendStatics=function extendStatics(d,b){_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}};return _extendStatics(d,b);};return function(d,b){_extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}}return t;};return __assign.apply(this,arguments);};import _ from\"lodash\";import React from\"react\";import View from\"react-native-web/dist/exports/View\";import{G,Rect,Svg,Text}from\"react-native-svg\";import AbstractChart from\"../AbstractChart\";import{mapValue}from\"../Utils\";import{convertToDate,getBeginningTimeForDate,shiftDate}from\"./DateHelpers\";import{DAYS_IN_WEEK,MILLISECONDS_IN_ONE_DAY,MONTH_LABELS}from\"./constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SQUARE_SIZE=20;var MONTH_LABEL_GUTTER_SIZE=8;var paddingLeft=32;var ContributionGraph=function(_super){__extends(ContributionGraph,_super);function ContributionGraph(props){var _this=_super.call(this,props)||this;var _a=_this.getValueCache(props.values),maxValue=_a.maxValue,minValue=_a.minValue,valueCache=_a.valueCache;_this.state={maxValue:maxValue,minValue:minValue,valueCache:valueCache};return _this;}ContributionGraph.prototype.UNSAFE_componentWillReceiveProps=function(nextProps){var _a=this.getValueCache(nextProps.values),maxValue=_a.maxValue,minValue=_a.minValue,valueCache=_a.valueCache;this.setState({maxValue:maxValue,minValue:minValue,valueCache:valueCache});};ContributionGraph.prototype.getSquareSizeWithGutter=function(){return(this.props.squareSize||SQUARE_SIZE)+this.props.gutterSize;};ContributionGraph.prototype.getMonthLabelSize=function(){var _a=this.props.squareSize,squareSize=_a===void 0?SQUARE_SIZE:_a;if(!this.props.showMonthLabels){return 0;}if(this.props.horizontal){return squareSize+MONTH_LABEL_GUTTER_SIZE;}return 2*(squareSize+MONTH_LABEL_GUTTER_SIZE);};ContributionGraph.prototype.getStartDate=function(){return shiftDate(this.getEndDate(),-this.props.numDays+1);};ContributionGraph.prototype.getEndDate=function(){return getBeginningTimeForDate(convertToDate(this.props.endDate));};ContributionGraph.prototype.getStartDateWithEmptyDays=function(){return shiftDate(this.getStartDate(),-this.getNumEmptyDaysAtStart());};ContributionGraph.prototype.getNumEmptyDaysAtStart=function(){return this.getStartDate().getDay();};ContributionGraph.prototype.getNumEmptyDaysAtEnd=function(){return DAYS_IN_WEEK-1-this.getEndDate().getDay();};ContributionGraph.prototype.getWeekCount=function(){var numDaysRoundedToWeek=this.props.numDays+this.getNumEmptyDaysAtStart()+this.getNumEmptyDaysAtEnd();return Math.ceil(numDaysRoundedToWeek/DAYS_IN_WEEK);};ContributionGraph.prototype.getWeekWidth=function(){return DAYS_IN_WEEK*this.getSquareSizeWithGutter();};ContributionGraph.prototype.getWidth=function(){return this.getWeekCount()*this.getSquareSizeWithGutter()-this.props.gutterSize;};ContributionGraph.prototype.getHeight=function(){return this.getWeekWidth()+(this.getMonthLabelSize()-this.props.gutterSize);};ContributionGraph.prototype.getValueCache=function(values){var _this=this;var minValue=Infinity,maxValue=-Infinity;return{valueCache:values.reduce(function(memo,value){var date=convertToDate(value.date);var index=Math.floor((date.valueOf()-_this.getStartDateWithEmptyDays().valueOf())/MILLISECONDS_IN_ONE_DAY);minValue=Math.min(value[_this.props.accessor],minValue);maxValue=Math.max(value[_this.props.accessor],maxValue);memo[index]={value:value,title:_this.props.titleForValue?_this.props.titleForValue(value):null,tooltipDataAttrs:_this.getTooltipDataAttrsForValue(value)};return memo;},{}),minValue:minValue,maxValue:maxValue};};ContributionGraph.prototype.getValueForIndex=function(index){if(this.state.valueCache[index]){return this.state.valueCache[index].value;}return null;};ContributionGraph.prototype.getClassNameForIndex=function(index){if(this.state.valueCache[index]){if(this.state.valueCache[index].value){var count=this.state.valueCache[index].value[this.props.accessor];if(count){var opacity=mapValue(count,this.state.maxValue===this.state.minValue?0:this.state.minValue,isNaN(this.state.maxValue)?1:this.state.maxValue,0.15+0.05,1);return this.props.chartConfig.color(opacity);}}}return this.props.chartConfig.color(0.15);};ContributionGraph.prototype.getTitleForIndex=function(index){if(this.state.valueCache[index]){return this.state.valueCache[index].title;}return this.props.titleForValue?this.props.titleForValue(null):null;};ContributionGraph.prototype.getTooltipDataAttrsForIndex=function(index){var _a;if(this.state.valueCache[index]){return this.state.valueCache[index].tooltipDataAttrs;}return this.getTooltipDataAttrsForValue((_a={date:null},_a[this.props.accessor]=null,_a));};ContributionGraph.prototype.getTooltipDataAttrsForValue=function(value){var tooltipDataAttrs=this.props.tooltipDataAttrs;if(typeof tooltipDataAttrs===\"function\"){return tooltipDataAttrs(value);}return tooltipDataAttrs;};ContributionGraph.prototype.getTransformForWeek=function(weekIndex){if(this.props.horizontal){return[weekIndex*this.getSquareSizeWithGutter(),50];}return[10,weekIndex*this.getSquareSizeWithGutter()];};ContributionGraph.prototype.getTransformForMonthLabels=function(){if(this.props.horizontal){return null;}return this.getWeekWidth()+MONTH_LABEL_GUTTER_SIZE+\", 0\";};ContributionGraph.prototype.getTransformForAllWeeks=function(){if(this.props.horizontal){return\"0, \"+(this.getMonthLabelSize()-100);}return null;};ContributionGraph.prototype.getViewBox=function(){if(this.props.horizontal){return this.getWidth()+\" \"+this.getHeight();}return this.getHeight()+\" \"+this.getWidth();};ContributionGraph.prototype.getSquareCoordinates=function(dayIndex){if(this.props.horizontal){return[0,dayIndex*this.getSquareSizeWithGutter()];}return[dayIndex*this.getSquareSizeWithGutter(),0];};ContributionGraph.prototype.getMonthLabelCoordinates=function(weekIndex){if(this.props.horizontal){return[weekIndex*this.getSquareSizeWithGutter(),this.getMonthLabelSize()-MONTH_LABEL_GUTTER_SIZE];}var verticalOffset=-2;return[0,(weekIndex+1)*this.getSquareSizeWithGutter()+verticalOffset];};ContributionGraph.prototype.renderSquare=function(dayIndex,index){var _this=this;var indexOutOfRange=index<this.getNumEmptyDaysAtStart()||index>=this.getNumEmptyDaysAtStart()+this.props.numDays;if(indexOutOfRange&&!this.props.showOutOfRangeDays){return null;}var _a=this.getSquareCoordinates(dayIndex),x=_a[0],y=_a[1];var _b=this.props.squareSize,squareSize=_b===void 0?SQUARE_SIZE:_b;return _jsx(Rect,_objectSpread({width:squareSize,height:squareSize,x:x+paddingLeft,y:y,title:this.getTitleForIndex(index),fill:this.getClassNameForIndex(index),onPress:function onPress(){_this.handleDayPress(index);}},this.getTooltipDataAttrsForIndex(index)),index);};ContributionGraph.prototype.handleDayPress=function(index){var _a;if(!this.props.onDayPress){return;}this.props.onDayPress(this.state.valueCache[index]&&this.state.valueCache[index].value?this.state.valueCache[index].value:(_a={},_a[this.props.accessor]=0,_a.date=new Date(this.getStartDate().valueOf()+index*MILLISECONDS_IN_ONE_DAY),_a));};ContributionGraph.prototype.renderWeek=function(weekIndex){var _this=this;var _a=this.getTransformForWeek(weekIndex),x=_a[0],y=_a[1];return _jsx(G,{x:x,y:y,children:_.range(DAYS_IN_WEEK).map(function(dayIndex){return _this.renderSquare(dayIndex,weekIndex*DAYS_IN_WEEK+dayIndex);})},weekIndex);};ContributionGraph.prototype.renderAllWeeks=function(){var _this=this;return _.range(this.getWeekCount()).map(function(weekIndex){return _this.renderWeek(weekIndex);});};ContributionGraph.prototype.renderMonthLabels=function(){var _this=this;if(!this.props.showMonthLabels){return null;}var weekRange=_.range(this.getWeekCount()-1);return weekRange.map(function(weekIndex){var endOfWeek=shiftDate(_this.getStartDateWithEmptyDays(),(weekIndex+1)*DAYS_IN_WEEK);var _a=_this.getMonthLabelCoordinates(weekIndex),x=_a[0],y=_a[1];return endOfWeek.getDate()>=1&&endOfWeek.getDate()<=DAYS_IN_WEEK?_jsx(Text,_objectSpread(_objectSpread({x:x+paddingLeft,y:y+8},_this.getPropsForLabels()),{},{children:_this.props.getMonthLabel?_this.props.getMonthLabel(endOfWeek.getMonth()):MONTH_LABELS[endOfWeek.getMonth()]}),weekIndex):null;});};ContributionGraph.prototype.render=function(){var style=this.props.style;var _a=style.borderRadius,borderRadius=_a===void 0?0:_a;if(!borderRadius&&this.props.chartConfig.style){var stupidXo=this.props.chartConfig.style.borderRadius;borderRadius=stupidXo;}return _jsx(View,{style:style,children:_jsxs(Svg,{height:this.props.height,width:this.props.width,children:[this.renderDefs(__assign({width:this.props.width,height:this.props.height},this.props.chartConfig)),_jsx(Rect,{width:\"100%\",height:this.props.height,rx:borderRadius,ry:borderRadius,fill:\"url(#backgroundGradient)\"}),_jsx(G,{children:this.renderMonthLabels()}),_jsx(G,{children:this.renderAllWeeks()})]})});};ContributionGraph.defaultProps={numDays:200,endDate:new Date(),gutterSize:1,squareSize:SQUARE_SIZE,horizontal:true,showMonthLabels:true,showOutOfRangeDays:false,accessor:\"count\",classForValue:function classForValue(value){return value?\"black\":\"#8cc665\";},style:{}};return ContributionGraph;}(AbstractChart);export default ContributionGraph;","map":{"version":3,"sources":["../../src/contribution-graph/ContributionGraph.tsx"],"names":[],"mappings":"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","sourcesContent":["import _ from \"lodash\";\nimport React from \"react\";\nimport { View } from \"react-native\";\nimport { G, Rect, RectProps, Svg, Text } from \"react-native-svg\";\n\nimport AbstractChart from \"../AbstractChart\";\nimport { mapValue } from \"../Utils\";\nimport {\n  convertToDate,\n  getBeginningTimeForDate,\n  shiftDate\n} from \"./DateHelpers\";\nimport {\n  DAYS_IN_WEEK,\n  MILLISECONDS_IN_ONE_DAY,\n  MONTH_LABELS\n} from \"./constants\";\nimport { ContributionGraphProps, ContributionGraphState } from \".\";\n\nconst SQUARE_SIZE = 20;\nconst MONTH_LABEL_GUTTER_SIZE = 8;\nconst paddingLeft = 32;\n\nexport type ContributionChartValue = {\n  value: number;\n  title: string;\n  tooltipDataAttrs: TooltipDataAttrs;\n  date: Date;\n};\n\nexport type TooltipDataAttrs = (\n  value: ContributionChartValue\n) => Partial<RectProps> | Partial<RectProps>;\n\nclass ContributionGraph extends AbstractChart<\n  ContributionGraphProps,\n  ContributionGraphState\n> {\n  constructor(props: ContributionGraphProps) {\n    super(props);\n\n    let { maxValue, minValue, valueCache } = this.getValueCache(props.values);\n\n    this.state = {\n      maxValue,\n      minValue,\n      valueCache\n    };\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: ContributionGraphProps) {\n    let { maxValue, minValue, valueCache } = this.getValueCache(\n      nextProps.values\n    );\n\n    this.setState({\n      maxValue,\n      minValue,\n      valueCache\n    });\n  }\n\n  getSquareSizeWithGutter() {\n    return (this.props.squareSize || SQUARE_SIZE) + this.props.gutterSize;\n  }\n\n  getMonthLabelSize() {\n    let { squareSize = SQUARE_SIZE } = this.props;\n    if (!this.props.showMonthLabels) {\n      return 0;\n    }\n    if (this.props.horizontal) {\n      return squareSize + MONTH_LABEL_GUTTER_SIZE;\n    }\n    return 2 * (squareSize + MONTH_LABEL_GUTTER_SIZE);\n  }\n\n  getStartDate() {\n    return shiftDate(this.getEndDate(), -this.props.numDays + 1); // +1 because endDate is inclusive\n  }\n\n  getEndDate() {\n    return getBeginningTimeForDate(convertToDate(this.props.endDate));\n  }\n\n  getStartDateWithEmptyDays() {\n    return shiftDate(this.getStartDate(), -this.getNumEmptyDaysAtStart());\n  }\n\n  getNumEmptyDaysAtStart() {\n    return this.getStartDate().getDay();\n  }\n\n  getNumEmptyDaysAtEnd() {\n    return DAYS_IN_WEEK - 1 - this.getEndDate().getDay();\n  }\n\n  getWeekCount() {\n    const numDaysRoundedToWeek =\n      this.props.numDays +\n      this.getNumEmptyDaysAtStart() +\n      this.getNumEmptyDaysAtEnd();\n    return Math.ceil(numDaysRoundedToWeek / DAYS_IN_WEEK);\n  }\n\n  getWeekWidth() {\n    return DAYS_IN_WEEK * this.getSquareSizeWithGutter();\n  }\n\n  getWidth() {\n    return (\n      this.getWeekCount() * this.getSquareSizeWithGutter() -\n      this.props.gutterSize\n    );\n  }\n\n  getHeight() {\n    return (\n      this.getWeekWidth() + (this.getMonthLabelSize() - this.props.gutterSize)\n    );\n  }\n\n  getValueCache(values: ContributionChartValue[]) {\n    let minValue = Infinity,\n      maxValue = -Infinity;\n\n    return {\n      valueCache: values.reduce((memo, value) => {\n        const date = convertToDate(value.date);\n\n        const index = Math.floor(\n          (date.valueOf() - this.getStartDateWithEmptyDays().valueOf()) /\n            MILLISECONDS_IN_ONE_DAY\n        );\n\n        minValue = Math.min(value[this.props.accessor], minValue);\n        maxValue = Math.max(value[this.props.accessor], maxValue);\n\n        memo[index] = {\n          value,\n          title: this.props.titleForValue\n            ? this.props.titleForValue(value)\n            : null,\n          tooltipDataAttrs: this.getTooltipDataAttrsForValue(value)\n        };\n\n        return memo;\n      }, {}),\n      minValue,\n      maxValue\n    };\n  }\n\n  getValueForIndex(index: number) {\n    if (this.state.valueCache[index]) {\n      return this.state.valueCache[index].value;\n    }\n    return null;\n  }\n\n  getClassNameForIndex(index: number) {\n    if (this.state.valueCache[index]) {\n      if (this.state.valueCache[index].value) {\n        const count = this.state.valueCache[index].value[this.props.accessor];\n\n        if (count) {\n          const opacity = mapValue(\n            count,\n            this.state.maxValue === this.state.minValue ? 0: this.state.minValue,\n            isNaN(this.state.maxValue) ? 1 : this.state.maxValue,\n            0.15 + 0.05, // + 0.05 to make smaller values a bit more visible\n            1\n          );\n\n          return this.props.chartConfig.color(opacity);\n        }\n      }\n    }\n\n    return this.props.chartConfig.color(0.15);\n  }\n\n  getTitleForIndex(index: number) {\n    if (this.state.valueCache[index]) {\n      return this.state.valueCache[index].title;\n    }\n\n    return this.props.titleForValue ? this.props.titleForValue(null) : null;\n  }\n\n  getTooltipDataAttrsForIndex(index: number) {\n    if (this.state.valueCache[index]) {\n      return this.state.valueCache[index].tooltipDataAttrs;\n    }\n\n    return this.getTooltipDataAttrsForValue({\n      date: null,\n      [this.props.accessor]: null\n    } as ContributionChartValue);\n  }\n\n  getTooltipDataAttrsForValue(value: ContributionChartValue) {\n    const { tooltipDataAttrs } = this.props;\n\n    if (typeof tooltipDataAttrs === \"function\") {\n      return tooltipDataAttrs(value);\n    }\n\n    return tooltipDataAttrs;\n  }\n\n  getTransformForWeek(weekIndex: number) {\n    if (this.props.horizontal) {\n      return [weekIndex * this.getSquareSizeWithGutter(), 50];\n    }\n    return [10, weekIndex * this.getSquareSizeWithGutter()];\n  }\n\n  getTransformForMonthLabels() {\n    if (this.props.horizontal) {\n      return null;\n    }\n    return `${this.getWeekWidth() + MONTH_LABEL_GUTTER_SIZE}, 0`;\n  }\n\n  getTransformForAllWeeks() {\n    if (this.props.horizontal) {\n      return `0, ${this.getMonthLabelSize() - 100}`;\n    }\n    return null;\n  }\n\n  getViewBox() {\n    if (this.props.horizontal) {\n      return `${this.getWidth()} ${this.getHeight()}`;\n    }\n    return `${this.getHeight()} ${this.getWidth()}`;\n  }\n\n  getSquareCoordinates(dayIndex: number) {\n    if (this.props.horizontal) {\n      return [0, dayIndex * this.getSquareSizeWithGutter()];\n    }\n    return [dayIndex * this.getSquareSizeWithGutter(), 0];\n  }\n\n  getMonthLabelCoordinates(weekIndex: number) {\n    if (this.props.horizontal) {\n      return [\n        weekIndex * this.getSquareSizeWithGutter(),\n        this.getMonthLabelSize() - MONTH_LABEL_GUTTER_SIZE\n      ];\n    }\n    const verticalOffset = -2;\n    return [\n      0,\n      (weekIndex + 1) * this.getSquareSizeWithGutter() + verticalOffset\n    ];\n  }\n\n  renderSquare(dayIndex: number, index: number) {\n    const indexOutOfRange =\n      index < this.getNumEmptyDaysAtStart() ||\n      index >= this.getNumEmptyDaysAtStart() + this.props.numDays;\n\n    if (indexOutOfRange && !this.props.showOutOfRangeDays) {\n      return null;\n    }\n\n    const [x, y] = this.getSquareCoordinates(dayIndex);\n    const { squareSize = SQUARE_SIZE } = this.props;\n\n    return (\n      <Rect\n        key={index}\n        width={squareSize}\n        height={squareSize}\n        x={x + paddingLeft}\n        y={y}\n        title={this.getTitleForIndex(index)}\n        fill={this.getClassNameForIndex(index)}\n        onPress={() => {\n          this.handleDayPress(index);\n        }}\n        {...this.getTooltipDataAttrsForIndex(index)}\n      />\n    );\n  }\n\n  handleDayPress(index: number) {\n    if (!this.props.onDayPress) {\n      return;\n    }\n\n    this.props.onDayPress(\n      this.state.valueCache[index] && this.state.valueCache[index].value\n        ? this.state.valueCache[index].value\n        : {\n            [this.props.accessor]: 0,\n            date: new Date(\n              this.getStartDate().valueOf() + index * MILLISECONDS_IN_ONE_DAY\n            )\n          }\n    );\n  }\n\n  renderWeek(weekIndex: number) {\n    const [x, y] = this.getTransformForWeek(weekIndex);\n    return (\n      <G key={weekIndex} x={x} y={y}>\n        {_.range(DAYS_IN_WEEK).map(dayIndex =>\n          this.renderSquare(dayIndex, weekIndex * DAYS_IN_WEEK + dayIndex)\n        )}\n      </G>\n    );\n  }\n\n  renderAllWeeks() {\n    return _.range(this.getWeekCount()).map(weekIndex =>\n      this.renderWeek(weekIndex)\n    );\n  }\n\n  renderMonthLabels() {\n    if (!this.props.showMonthLabels) {\n      return null;\n    }\n\n    const weekRange = _.range(this.getWeekCount() - 1); // don't render for last week, because label will be cut off\n\n    return weekRange.map(weekIndex => {\n      const endOfWeek = shiftDate(\n        this.getStartDateWithEmptyDays(),\n        (weekIndex + 1) * DAYS_IN_WEEK\n      );\n\n      const [x, y] = this.getMonthLabelCoordinates(weekIndex);\n\n      return endOfWeek.getDate() >= 1 && endOfWeek.getDate() <= DAYS_IN_WEEK ? (\n        <Text\n          key={weekIndex}\n          x={x + paddingLeft}\n          y={y + 8}\n          {...this.getPropsForLabels()}\n        >\n          {this.props.getMonthLabel\n            ? this.props.getMonthLabel(endOfWeek.getMonth())\n            : MONTH_LABELS[endOfWeek.getMonth()]}\n        </Text>\n      ) : null;\n    });\n  }\n\n  public static defaultProps = {\n    numDays: 200,\n    endDate: new Date(),\n    gutterSize: 1,\n    squareSize: SQUARE_SIZE,\n    horizontal: true,\n    showMonthLabels: true,\n    showOutOfRangeDays: false,\n    accessor: \"count\",\n    classForValue: value => (value ? \"black\" : \"#8cc665\"),\n    style: {}\n  };\n\n  render() {\n    const { style } = this.props;\n\n    let { borderRadius = 0 } = style;\n\n    if (!borderRadius && this.props.chartConfig.style) {\n      const stupidXo = this.props.chartConfig.style.borderRadius;\n      borderRadius = stupidXo;\n    }\n\n    return (\n      <View style={style}>\n        <Svg height={this.props.height} width={this.props.width}>\n          {this.renderDefs({\n            width: this.props.width,\n            height: this.props.height,\n            ...this.props.chartConfig\n          })}\n          <Rect\n            width=\"100%\"\n            height={this.props.height}\n            rx={borderRadius}\n            ry={borderRadius}\n            fill=\"url(#backgroundGradient)\"\n          />\n          <G>{this.renderMonthLabels()}</G>\n          <G>{this.renderAllWeeks()}</G>\n        </Svg>\n      </View>\n    );\n  }\n}\n\nexport default ContributionGraph;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}